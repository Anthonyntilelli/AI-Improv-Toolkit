# NATS Server Configuration for Improv Show
# The admin is removed and JetStream is configured to use memory-only storage (no data persisted to disk).
server_name: improv-nats-server
host: 0.0.0.0
port: 4222

debug: false
trace: false

jetstream {
  max_file_store: 0
  max_mem_store: 1G
}

tls {
  cert_file: "/etc/pki/server-cert.pem"
  key_file:  "/etc/pki/server-key.pem"
  ca_file:   "/etc/pki/ca-cert.pem"
  verify_and_map: true
}

authorization {
  SETTINGS = {
    publish   = ["$JS.API.>", "$KV.SETTINGS.>", "$KV.STATUS.SETTINGS", "$KV.STATUS.SETTINGS.MESSAGE", "HEALTHCHECK.SETTINGS"]
    subscribe = ["$JS.API.>", "$KV.SETTINGS.>", "INTERFACE", "_INBOX.>"]
  }

  INGEST = {
    publish   = ["$JS.API.>", "$KV.STATUS.INGEST", "$KV.STATUS.INGEST.MESSAGE", "HEALTHCHECK.INGEST", "INTERFACE"]
    subscribe = ["$JS.API.>", "$KV.SETTINGS.>", "_INBOX.>"]
  }

  VISION = {
    publish   = ["$JS.API.>", "$KV.STATUS.VISION", "$KV.STATUS.VISION.MESSAGE", "VISION.>", "HEALTHCHECK.VISION"]
    subscribe = ["$JS.API.>", "$KV.SETTINGS.>", "_INBOX.>", "INTERFACE"]
  }

  HEARING = {
    publish   = ["$JS.API.>", "$KV.STATUS.HEARING", "$KV.STATUS.HEARING.MESSAGE", "HEARING.>", "HEALTHCHECK.HEARING"]
    subscribe = ["$JS.API.>", "$KV.SETTINGS.>", "_INBOX.>", "INTERFACE"]
  }

  BRAIN = {
    publish   = ["$JS.API.>", "$KV.STATUS.BRAIN","$KV.STATUS.BRAIN.MESSAGE", "OUTPUT.>", "HEALTHCHECK.BRAIN"]
    subscribe = ["$JS.API.>", "$KV.SETTINGS.>", "_INBOX.>", "INTERFACE", "VISION.>", "HEARING.>"]
  }

  OUTPUT = {
    publish   = ["$JS.API.>", "$KV.STATUS.OUTPUT","$KV.STATUS.OUTPUT.MESSAGE", "HEALTHCHECK.OUTPUT"]
    subscribe = ["$JS.API.>", "$KV.SETTINGS.>", "_INBOX.>", "INTERFACE", "OUTPUT.>"]
  }

  HEALTHCHECK = {
    publish   = ["$KV.STATUS.HEALTHCHECK", "$KV.STATUS.HEALTHCHECK.MESSAGE"]
    subscribe = ["HEALTHCHECK.>", "INTERFACE", "$KV.SETTINGS.>", "_INBOX.>", "$KV.STATUS.>"]
  }

  users = [
    { user: "setting@improvShow.local",      permissions: $SETTINGS }
    { user: "ingest@improvShow.local",       permissions: $INGEST }
    { user: "vision@improvShow.local",       permissions: $VISION }
    { user: "hearing@improvShow.local",      permissions: $HEARING }
    { user: "brain@improvShow.local",        permissions: $BRAIN }
    { user: "output@improvShow.local",       permissions: $OUTPUT }
    { user: "health_check@improvShow.local", permissions: $HEALTHCHECK }
  ]
}
